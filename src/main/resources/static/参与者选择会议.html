<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>参与者查看会议</title>
    <!-- Common plugins -->
    <script src="js/jquery.min.js"></script>


    <link href="会务管理系统样式1/css/bootstrap.min.css" rel="stylesheet">
    <link href="会务管理系统样式1/css/simple-line-icons.css" rel="stylesheet">
    <link href="会务管理系统样式1/css/font-awesome.min.css" rel="stylesheet">
    <link href="会务管理系统样式1/css/pace.css" rel="stylesheet">
    <link href="会务管理系统样式1/css/jasny-bootstrap.min.css" rel="stylesheet">
    <link rel="会务管理系统样式1/stylesheet" href="css/nanoscroller.css">
    <link rel="会务管理系统样式1/stylesheet" href="css/metismenu.min.css">
    <link href="会务管理系统样式1/css/c3.min.css" rel="stylesheet">
    <link href="会务管理系统样式1/css/blue.css" rel="stylesheet">
    <!-- dataTables -->
    <link href="会务管理系统样式1/css/jquery.datatables.min.css" rel="stylesheet" type="text/css">
    <link href="会务管理系统样式1/css/responsive.bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="会务管理系统样式1/css/jquery.toast.min.css" rel="stylesheet">
    <!--template css-->
    <link href="会务管理系统样式1/css/style.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->

    <script src="会务管理系统样式1/js/html5shiv.min.js"></script>
    <script src="会务管理系统样式1/js/respond.min.js"></script>

    <link rel="stylesheet" href="会务管理系统样式1/fonts/iconfont.css">
    <link href="assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/css/simple-line-icons.css" rel="stylesheet">
    <link href="assets/css/font-awesome.min.css" rel="stylesheet">
    <link href="assets/css/pace.css" rel="stylesheet">
    <link href="assets/css/jasny-bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/nanoscroller.css">
    <link rel="stylesheet" href="assets/css/metismenu.min.css">
    <link href="assets/css/c3.min.css" rel="stylesheet">
    <link href="assets/css/blue.css" rel="stylesheet">
    <!-- dataTables -->
    <link href="css/jquery.datatables.min.css" rel="stylesheet" type="text/css">
    <link href="css/responsive.bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="css/jquery.toast.min.css" rel="stylesheet">
    <!--template css-->
    <link href="css/style.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="js/html5shiv.min.js"></script>
    <script src="js/respond.min.js"></script>
    <style type="text/css">
        *{
            margin: 0px;
            padding: 0px;
        }
        .container a .items{
            border: 1px solid#eeeeee;
            /* padding: 5px; */
            margin-bottom: 50px;
            background-color: #ffffff;
            box-shadow: 0px 0 16px rgba(0, 0, 0, 0.2);
        }
        .container a .items p {
            color: #6f6f6f;
            padding :0px 10px;
            margin: 0px;
        }
        .container a .items h4{
            padding :0px 10px;
            margin-top:10px;
            color: #666666;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .container a:hover div{
            transform: scale(1.15);
            transition: all .65s;
            overflow: hidden;
        }
        .container a:hover h4{
            color: #00a0e9;
        }
        .container a p span{
            color :#d7d7d7;
        }
        .back-to-top {
            position: fixed;
            display: none;
            width: 40px;
            height: 40px;
            border-radius: 3px;
            right: 15px;
            bottom: 15px;
            background: #428bca;
            color: #ffffff;
            text-align: center;
            line-height: 40px;
            transition: display 0.5s ease-in-out;
            z-index: 99999;
        }
    </style>
    <![endif]-->
    <script src="https://static.runoob.com/assets/jquery-validation-1.14.0/lib/jquery.js"></script>
    <script src="https://static.runoob.com/assets/jquery-validation-1.14.0/dist/jquery.validate.min.js"></script>
    <script src="https://static.runoob.com/assets/jquery-validation-1.14.0/dist/localization/messages_zh.js"></script>
    <script>
        let organizer;
        let token;
        let $participantId;
        let conference;
        $(function (){
            $(window).scroll(function() {
                if ($(this).scrollTop() > 100)  $('.back-to-top').fadeIn('slow');
                else $('.back-to-top').fadeOut('slow');
            });
            token = localStorage.getItem("xj");
            console.log(token);
            $participantId = parseJwt(token).participantId
            $.ajax({
                async: false,
                url: "/conference/showConferences",
                type: "get",
                dataType: "text",
                data: {
                },
                success: function (data) {
                    var listConference = "";
                    // console.log(data);
                    // console.log(typeof data)
                    data = JSON.parse(data)
                    // console.log(typeof data)
                    // console.log(data['data']['conferencesList'])
                    var conferences = data['data']['conferencesList'];

                    // console.log(conferences);
                    for(var i = 0 ; i < conferences.length ; i ++ ){
                        // console.log(conferences[i]);
                        var conferenceName = conferences[i].conferenceName;
                        var conferenceLocation = conferences[i].conferenceLocation;
                        var conferenceStart = conferences[i].conferenceStart;
                        var conferenceEnd = conferences[i].conferenceEnd;
                        var conferenceId = conferences[i].conferenceId;
                        var conferenceInfo = conferences[i].conferenceInfo;
                        // console.log(conferenceId);
                        var organizerId = conferences[i].organizerId;

                        getOrganizerInfo(organizerId);

                        var organizerUnit = organizer.organizerUnit;

                        listConference += '   <div class="col-lg-3" style = "margin: 0px 10px;">' +
                            '                        <a href = "#">' +
                            '                            <div class="items">' +
                            '                                <img class="img-responsive" src="会务管理系统样式1/picture/conferenceImg.jpeg" />' +
                            '                                <h4>'+ conferenceName +'</h4>' +
                            '                                <p> <span class="iconfont icon-dizhi"></span> '+conferenceLocation+'</p>' +
                            '                                <p> <span class="iconfont icon-shijian"></span>'+conferenceStart + '-' +conferenceEnd +'</p>' +
                            '                                <p> <span class="iconfont icon-zhubandanwei"></span> '+organizerUnit+'</p>' +
                            '                                <a id="info" type="button" class="btn btn-primary" data-toggle="modal" data-target="#lingchen'+conferenceId+'">会议详情</a>' +
                            '                                <a id="new_add" type="button" class="btn btn-success" data-toggle="modal" data-target="#renyuan'+conferenceId+'">加入会议</a>' +
                            '                            </div>' +
                            '                        </a>' +
                            '<div class="box">' +
                            '    <div class="content">' +
                            '        <!--添加按钮及bootstrap的模态框-->' +
                            '        <div class="export">' +
                            '            <div class="modal fade" id="renyuan'+conferenceId+'">' +
                            '                <div class="modal-dialog modal-lg modal_position">' +
                            '                    <div class="modal-content">' +
                            '                        <div class="modal-header">' +
                            '                            <h4 class="modal-title" id="">加入会议</h4>' +
                            '                            <button type="button" class="close" data-dismiss="modal">&times;</button>' +
                            '                        </div>\n' +
                            '                        <!-- 模态弹窗部分开始 -->' +
                            '                        <div class="modal-body">' +
                            '                            <table id="xztb" class="table">' +
                            '                                <!--新修改弹窗的样式-->' +
                            '                                <tbody>' +
                            '                                <tr>' +
                            '                                    <td class=""><label for=""><font style="font-size: 14px; color: red;">*</font>住宿</label>' +
                            '                                    </td>' +
                            '                                    <td><input  type="radio" name="isPutup" value="true" id="putup" />是&nbsp;&nbsp;&nbsp;&nbsp;' +
                            '                                    <input  type="radio" name="isPutup"  value="false" id="unput"/>否</td>' +
                            '                                </tr>' +
                            '                                <tr>' +
                            '                                    <td class="tb_bg"><label for=""><font style="font-size: 14px; color: red;">*</font>接送</label>' +
                            '                                    </td>' +
                            '                                    <td><input  type="radio" name="isPickup" value="true" id="pick"/>是&nbsp;&nbsp;&nbsp;&nbsp;' +
                            '                                    <input  type="radio" name="isPickup"  value="false" id="unpick"/>否</td>' +
                            '                                </tr>' +
                            '                                <tr>' +
                            '                                    <td class="tb_bg"><label for="">到达时间</label></td>' +
                            '                                    <td><input type="text" name="toTime" id="toTime'+i+'" placeholder="2020-12-10 09:00:00" value="2020-12-09 09:00:00"></td>' +
                            '                                </tr>' +
                            '                                <tr>' +
                            '                                    <td class="tb_bg"><label for="">离开时间</label></td>' +
                            '                                    <td><input type="text" name="returnTime" id="returnTime'+i+'" placeholder="2020-12-12 12:00:00" value="2020-12-10 09:00:00"></td>' +
                            '                                </tr>' +
                            '                                <tr>'+
                            '                                      <td class="tb_bg"><label for="">车次/航班号</label></td>'+
                            '                                      <td><input type="text" name="trainNumber" id="trainNumber'+i+'" value="G1234" ></td>'+
                            '                                </tr>'+
                            '                                </tbody>' +
                            '                            </table>' +
                            '                        </div>' +
                            '                        <div class="modal-footer">' +
                            '                            <button type="button" class="btn btn-danger" data-dismiss="modal">取消</button>' +
                            '                            <button id="add_btn" type="button" class="btn btn-success" onclick=\"attendConference('+ i + ','+ conferenceId + ')\">加入</button>' +
                            '                        </div>' +
                            '                        <!--模态弹窗部分结束 -->' +
                            '                    </div>' +
                            '                </div>' +
                            '            </div>' +
                            '            <div class="modal fade" id="lingchen'+conferenceId+'">' +
                            '                <div class="modal-dialog modal-lg modal_position">' +
                            '                    <div class="modal-content">' +
                            '                        <div class="modal-header">' +
                            '                            <h4 class="modal-title" id="">会议详情</h4>' +
                            '                            <button type="button" class="close" data-dismiss="modal">&times;</button>' +
                            '                        </div>\n' +
                            '                        <!-- 模态弹窗部分开始 -->' +
                            '                        <div class="modal-body">' +
                            '                            <table id="xztb" class="table">' +
                            '                                <!--新修改弹窗的样式-->' +
                            '                                <tbody>' +
                            '                                <tr>' +
                            '                                    <td class="tb_bg"><label for="">会议名称</label></td>' +
                            '                                    <td><input type="text" name="conferenceName" id="conferenceName'+i+'" readonly unselectable="on"  value="'+ conferenceName +'"></td>' +
                            '                                </tr>' +
                            '                                <tr>' +
                            '                                    <td class="tb_bg"><label for="">会议开始时间</label></td>' +
                            '                                    <td><input type="text" name="conferenceStart" id="conferenceStart'+i+'" readonly unselectable="on" value="'+ conferenceStart +'"></td>' +
                            '                                </tr>' +
                            '                                <tr>'+
                            '                                      <td class="tb_bg"><label for="">会议结束时间</label></td>'+
                            '                                      <td><input type="text" name="conferenceEnd" id="conferenceEnd'+i+'" readonly unselectable="on" value="'+ conferenceEnd +'"></td>'+
                            '                                </tr>'+
                            '                                <tr>' +
                            '                                    <td class="tb_bg"><label for="">会议地点</label></td>' +
                            '                                    <td><input type="text" name="conferenceLocation" id="conferenceLocation'+i+'" readonly unselectable="on" value="'+ conferenceLocation +'"></td>' +
                            '                                </tr>' +
                            '                                <tr>' +
                            '                                    <td class="tb_bg"><label for="">会议相关信息</label></td>' +
                            '                                    <td><input type="text" name="conferenceInfo" id="conferenceInfo'+i+'" readonly unselectable="on" value="'+ conferenceInfo +'"></td>' +
                            '                                </tr>' +
                            '                                <tr>' +
                            '                                    <td class="tb_bg"><label for="">会议主办单位</label></td>' +
                            '                                    <td><input type="text" name="organizerUnit" id="organizerUnit'+i+'" readonly unselectable="on" value="'+ organizerUnit +'"></td>' +
                            '                                </tr>' +
                            '                                </tbody>' +
                            '                            </table>' +
                            '                        </div>' +
                            '                        <div class="modal-footer">' +
                            '                            <button type="button" class="btn btn-success" data-dismiss="modal">确定</button>' +
                            '                        </div>' +
                            '                        <!--模态弹窗部分结束 -->' +
                            '                    </div>' +
                            '                </div>' +
                            '            </div>' +
                            '        </div>' +
                            '    </div>' +
                            '</div>'+
                            '                   </div>'
                    }
                    $('#mainContent').html(listConference);
                    // if (data["code"] === 200) {
                    //     alert("获取会议数据成功");
                    // } else {
                    //     alert("获取数据失败1");
                    // }
                },
                error: function () {
                    alert("获取会议数据失败");
                },
            });
        })

        function getOrganizerInfo(organizerId) {

            $.ajax({
                async: false,
                url: "/organizer/getOrganizerInfo",
                type: "get",
                dataType: "text",
                data: {
                    'organizerId': organizerId,
                },
                success: function (data) {
                    data = JSON.parse(data)
                    organizer = data['data']['getOrganizerInfo'];
                },
                error: function () {
                    alert("获取用户数据失败2");
                },
            });
        }

        function attendConference(i,conferenceId){
            // alert(1)
            let message = "";
            getConferenceInfo(conferenceId)
            // let conferenceId = conference.conferenceId;
            let conferenceStart = conference.conferenceStart;
            let conferenceEnd = conference.conferenceEnd;
            let putup = $("input[name='isPutup']:checked").val();
            let pickup = $("input[name='isPickup']:checked").val();
            let toTime = $("#toTime"+i).val();
            let returnTime = $("#returnTime"+i).val();
            let trainNumber = $("#trainNumber"+i).val();
            if(typeof putup == "undefined"){
                message += "是否住宿必选！\n";
                // alert("是否住宿必选！")
                // return
            }
            if(typeof pickup == "undefined"){
                message += "是否接送必选！\n";
                // alert("是否接送必选！")
                // return
            }
            if(toTime ==""){
                message += "到达时间不能为空！\n";
                // alert("到达时间不能为空！")
                // return
            } else if(toTime >= conferenceStart){
                message += "到达时间不能晚于会议开始时间: " + conferenceStart + "！\n";
                // alert("到达时间不能晚于会议开始时间！"+conferenceStart)
                // return
            }
            if(returnTime ==""){
                message += "离开时间不能为空！\n";
                // alert("离开时间不能为空！")
                // return
            } else if(returnTime < conferenceEnd){
                message += "离开时间不能早于会议结束时间: " + conferenceEnd + "！\n";
                // alert("离开时间不能早于会议结束时间！"+conferenceEnd)
                // return
            }
            if(toTime > returnTime){
                message += "到达时间不能晚于离开时间！\n";
                // alert("到达时间不能晚于离开时间！")
                // return
            }
            if(trainNumber ==""){
                message += "车次/航班号不能为空！\n";
                // alert("车次/航班号不能为空！")
                // return
            }
            if(message != ""){
                alert(message);
                return
            }

            alert(putup)
            alert(pickup)
            alert(toTime)
            alert(returnTime)
            alert(trainNumber)
            $.ajax({
                async: false,
                type: "POST",
                dataType: "json",
                url: "/joinConference/joinAConference",
                contentType: "application/json",
                data:JSON.stringify ({
                    "participantId":""+$participantId,
                    "conferenceId":""+conferenceId,
                    "isPutup":""+putup,
                    "isPickup":""+pickup,
                    "toTime":""+toTime,
                    "returnTime":""+returnTime,
                    "trainNumber": ""+trainNumber,
                    "isConfirm":false,
                }),
                success: function (data) {
                    //data = JSON.parse(data)
                    if(data['code']==200){
                        alert("申请成功！等待组织者审核！");
                        window.location.href = "参与者待审核会议.html";
                    }else{
                        alert("加入失败！"+ data['message'])
                        window.location.href = "参与者选择会议.html";
                    }
                    console.log(data)
                },
                error: function () {
                    alert("获取用户数据失败2");
                },
            });

        }
        /*获取token里面的用户数据*/
        function parseJwt(token) {
            var base64Url = token.split('.')[1];
            var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            var jsonPayload = decodeURIComponent(atob(base64).split('').map(function (c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));
            return JSON.parse(jsonPayload);
        }
        function getConferenceInfo(conferenceId){
            $.ajax({
                async: false,
                url: "/conference/showConferenceById",
                type: "get",
                dataType: "text",
                data: {
                    'conferenceId':""+conferenceId
                },
                success: function (data) {
                    data = JSON.parse(data)
                    conference = data['data']['conference'];
                },
            });
        }
    </script>
</head>
<body>

<!--top bar start-->
<div class="top-bar light-top-bar">
    <div class="container-fluid">
        <div class="row">
            <div class="col-xs-4">
                <a href="participant-index.html" class="admin-logo">
                    <h1><img src="assets/picture/meeting.jpg" alt=""></h1>
                </a>
                <!-- 以下div为页面缩小后出现左边导航栏的按钮  -->
                <div class="left-nav-toggle visible-xs visible-sm">
                    <a href="">
                        <i class="glyphicon glyphicon-menu-hamburger"></i>
                    </a>
                </div><!--end nav toggle icon-->
            </div>
            <!--以下div为顶部导航栏-->
            <div class="col-xs-8">
                <ul class="list-inline top-right-nav">
                    <li >
                        <a href="参与者消息.html" >
                            <span class="glyphicon glyphicon-envelope"> 消息</span>
                        </a>
                    </li>
                    <li >
                        <a href="登录.html" >
                            <span class="glyphicon glyphicon-log-out"> 退出登录</span>
                        </a>
                    </li>
                    <li>
                        <a href="participant-index.html">
                            <span><img src="assets/picture/avtar-1.jpg" class="img-circle" width="30" alt=""></span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>
<!-- top bar end-->

<!--左侧导航栏开始-->
<aside class="float-navigation light-navigation">
    <div class="nano">
        <div class="nano-content">
            <ul class="metisMenu nav" id="menu">
                <li>
                    <a href="participant-index.html"><i class="icon-home"></i> 主页 </a>
                </li>
                <li>
                    <a href="参与者个人信息.html"><i class="icon-user"></i> 个人信息 </a>
                </li>
                <li class="active">
                    <a href="javascript: void(0);" aria-expanded="true"><i class="icon-note"></i> 会议 <span class="fa arrow"></span></a>
                    <ul class="nav-second-level nav" aria-expanded="true">
                        <li><a href="参与者选择会议.html">选择会议</a></li>
                        <li><a href="参与者待审核会议.html">待审核会议</a></li>
                        <li><a href="参与者已参加会议.html">已参加会议</a></li>
                    </ul>
                </li>
                <li>
                    <a href="javascript: void(0);" aria-expanded="true"><i class="icon-envelope-letter"></i> 消息 <span class="fa arrow"></span></a>
                    <ul class="nav-second-level nav" aria-expanded="true">
                        <li id="to-look-pickup"><a href="参与者查看接送信息.html">接送信息</a></li>
                        <li id="to-look-putup"><a href="参与者查看住宿情况.html">住宿情况</a></li>
                    </ul>
                </li>
            </ul>
        </div><!--nano content-->
    </div><!--nano scroll end-->
</aside>
<!--左侧导航栏结束-->


<!--页面主体内容部分开始-->
<section class="main-content">
    <!--页面主体头部开始-->
    <div class="page-header">
        <div class="row">
            <!--                    <div class="col-sm-6">-->
            <!--                        <h4>Welcome!</h4>-->
            <!--                    </div>-->
            <!--面包屑导航-->
            <div class="col-sm-12 text-right">
                <ol class="breadcrumb">
                    <li><a href="participant-index.html"><i class="fa fa-home"></i></a></li>
                    <li>会议</li>
                    <li>选择会议</li>
                </ol>
            </div>
        </div>
    </div>
    <!--主体页面头部结束-->

    <!--页面主体内容部分开始-->
    <div class="container" id = "mainContent">
    </div>
    <!--页面主体内容部分结束-->


    <!--Start footer-->
    <footer class="footer">
        <span>Copyright &copy; 2020. 南昌大学</span>
    </footer>
    <!--end footer-->

</section>
<!--end main content-->



<!--Common plugins-->
<script src="js/jquery.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/pace.min.js"></script>
<script src="js/jasny-bootstrap.min.js"></script>
<script src="js/jquery.slimscroll.min.js"></script>
<script src="js/jquery.nanoscroller.min.js"></script>
<script src="js/metismenu.min.js"></script>
<script src="js/float-custom.js"></script>
<!--page script-->
<script src="js/d3.min.js"></script>
<script src="js/c3.min.js"></script>
<!-- iCheck for radio and checkboxes -->
<script src="js/icheck.min.js"></script>
<!-- Datatables-->
<script src="js/jquery.datatables.min.js"></script>
<script src="js/datatables.responsive.min.js"></script>
<script src="js/jquery.toast.min.js"></script>
<script src="js/dashboard-alpha.js"></script>
</body>
</html>