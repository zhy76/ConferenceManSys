<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>组织者单位信息</title>
    <!-- Common plugins -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/css/simple-line-icons.css" rel="stylesheet">
    <link href="assets/css/font-awesome.min.css" rel="stylesheet">
    <link href="assets/css/pace.css" rel="stylesheet">
    <link href="assets/css/jasny-bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/nanoscroller.css">
    <link rel="stylesheet" href="css/metismenu.min.css">
    <link href="css/c3.min.css" rel="stylesheet">
    <link href="css/blue.css" rel="stylesheet">
    <!-- dataTables -->
    <link href="css/jquery.datatables.min.css" rel="stylesheet" type="text/css">
    <link href="css/responsive.bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="css/jquery.toast.min.css" rel="stylesheet">
    <!--template css-->
    <link href="css/style.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="js/html5shiv.min.js"></script>
    <script src="js/respond.min.js"></script>
    <![endif]-->
</head>
<body>

<!--top bar start-->
<div class="top-bar light-top-bar">
    <div class="container-fluid">
        <div class="row">
            <div class="col-xs-4">
                <a href="组织者主页面.html" class="admin-logo">
                    <h1><img src="assets/picture/meeting.jpg" alt=""></h1>
                </a>
                <!-- 以下div为页面缩小后出现左边导航栏的按钮  -->
                <div class="left-nav-toggle visible-xs visible-sm">
                    <a href="">
                        <i class="glyphicon glyphicon-menu-hamburger"></i>
                    </a>
                </div><!--end nav toggle icon-->
            </div>
            <!--以下div为顶部导航栏-->
            <div class="col-xs-8">
                <ul class="list-inline top-right-nav">
                    <li >
                        <a href="组织者消息.html" >
                            <span class="glyphicon glyphicon-envelope"> 消息</span>
                        </a>
                    </li>
                    <li >
                        <a href="登录.html" >
                            <span class="glyphicon glyphicon-log-out"> 退出登录</span>
                        </a>
                    </li>
                    <li>
                        <a href="组织者主页面.html">
                            <span><img src="assets/picture/avtar-1.jpg" class="img-circle" width="30" alt=""></span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>
<!-- top bar end-->

<!--左侧导航栏开始-->
<aside class="float-navigation light-navigation">
    <div class="nano">
        <div class="nano-content">
            <ul class="metisMenu nav" id="menu">
                <!--                        <li class="nav-heading"><span>Navigation</span></li>-->
                <li>
                    <a href="组织者主页面.html"><i class="icon-home"></i> 主页 </a>
                </li>
                <li>
                    <a href="组织者单位信息.html"><i class="icon-user"></i> 单位信息 </a>
                </li>
                <li>
                    <a href="javascript: void(0);" aria-expanded="true"><i class="icon-note"></i> 会议 <span class="fa arrow"></span></a>
                    <ul class="nav-second-level nav" aria-expanded="true">
                        <li><a href="组织者生成会议.html">生成会议</a></li>
                        <li><a href="组织者查看会议.html">查看会议</a></li>
                        <li><a href="组织者审核会议.html">审核会议</a></li>
                    </ul>
                </li>
                <li>
                    <a href="组织者消息.html"><i class="icon-envelope-letter"></i> 消息 </a>
                </li>
            </ul>
        </div><!--nano content-->
    </div><!--nano scroll end-->
</aside>
<!--左侧导航栏结束-->


<!--页面主体内容部分开始-->
<section class="main-content">
    <!--页面主体头部开始-->
    <div class="page-header">
        <div class="row">
            <!--面包屑导航-->
            <div class="col-sm-12 text-right">
                <ol class="breadcrumb">
                    <li><a href="javascript: void(0);"><i class="fa fa-home"></i></a></li>
                    <li>单位信息</li>
                </ol>
            </div>
        </div>
    </div>
    <!--主体页面头部结束-->

    <!--页面主体内容部分开始-->
    <div class="page-wrapper">
        <div class="container-fluid">
            <!-- Row -->
            <div class="row">
                <!-- Column -->
                <div class="col-sm-11">
                    <div class="card">
                        <!-- Nav tabs -->
                        <ul class="nav nav-tabs profile-tab" role="tablist">
                            <li class="nav-item" id="to-info"> <a class="nav-link" data-toggle="tab" href="#个人信息" role="tab">个人信息</a> </li>
                        </ul>
                        <!-- Tab panes -->
                        <div class="tab-content">
                            <div class="tab-pane" id="个人信息" role="tabpanel">
                                <div class="card-body">
                                    <form class="form-horizontal form-material">
                                        <br>
                                        <div class="form-group">
                                            <label class="col-md-12">单位名称</label>
                                            <div class="col-md-12">
                                                <input type="text" id="organizerUnit" class="form-control form-control-line" value="左海余大公司">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-md-12">联系邮箱</label>
                                            <div class="col-md-12">
                                                <input type="text" id="organizerEmail" class="form-control form-control-line" value="958474674@qq.com">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-md-12">联系电话</label>
                                            <div class="col-md-12">
                                                <input type="text" id=" organizerPhone" value="17770835165" class="form-control form-control-line">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-md-12">密码</label>
                                            <div class="col-md-12">
                                                <input type="password" id="organizerPass" value="password" class="form-control form-control-line">
                                            </div>
                                        </div>

                                        <br/>
                                        <br/>
                                        <div class="form-group">
                                            <div class="col-sm-12 text-center" >
                                                <a type="submit" id="update" class="btn btn-info">修改信息</a>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Column -->
            </div>
            <!-- Row -->

        </div>
    </div>

    <!--页面主体内容部分结束-->


    <!--Start footer-->
    <footer class="footer">
        <span>Copyright &copy; 2020. 南昌大学</span>
    </footer>
    <!--end footer-->

</section>
<!--end main content-->



<!--Common plugins-->
<script src="js/jquery.min.js"></script>
<script src="js/popper.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/pace.min.js"></script>
<script src="js/jasny-bootstrap.min.js"></script>
<script src="js/jquery.slimscroll.min.js"></script>
<script src="js/jquery.nanoscroller.min.js"></script>
<script src="js/metismenu.min.js"></script>
<script src="js/float-custom.js"></script>
<script src="js/waves.js"></script>
<script src="js/custom.min.js"></script>
<script src="js/sidebarmenu.js"></script>
<!--stickey kit -->
<script src="js/sticky-kit.min.js"></script>
<script src="js/jquery.sparkline.min.js"></script>
<!--jquery steps-->
<script src="js/jQuery.style.switcher.js"></script>
<script src="js/jquery.steps.min.js"></script>
<script src="js/jquery.validate.min.js"></script>
<script>
    $("#example-basic").steps({
        headerTag: "h3",
        bodyTag: "section",

        autoFocus: true
    });
    //steps with form
    var form = $("#example-form");
    form.validate({
        errorPlacement: function errorPlacement(error, element) {
            element.before(error);
        },
        rules: {
            confirm: {
                equalTo: "#password"
            }
        }
    });
    form.children("div").steps({
        headerTag: "h3",
        bodyTag: "section",
        transitionEffect: "slideLeft",
        onStepChanging: function (event, currentIndex, newIndex)
        {
            form.validate().settings.ignore = ":disabled,:hidden";
            return form.valid();
        },
        onFinishing: function (event, currentIndex)
        {
            form.validate().settings.ignore = ":disabled";
            return form.valid();
        },
        onFinished: function (event, currentIndex)
        {
            alert("Submitted!");
        }
    });
</script>

<script type="text/javascript">
    let organizer;
    let token;
    let $organizerId;
    $(function (){

        token = localStorage.getItem("zhy");
        console.log(typeof (token));
        console.log(token);
        if (token == null || token === "null" || token === "undefined") {
            console.log("no token");
        } else {
            $organizerId = parseJwt(token).organizerId;/*获取用户信息*/
            console.log($organizerId);
        }
        /**
         * 点击->个人信息
         */
        $("#to-info a").click(function () {

            getOrganizerInfo()($organizerId);
            console.log(organizer.organizerPhone)
            console.log($("#organizerPhone").val())
            $("#organierUnit").val(organizer.organizerUnit);
            $("#organizerEmail").val(organizer.organizerEmail);
            $("#organizerPhone").val(organizer.organizerPhone);
            $("#organizerPass").val(organizer.organizerPass);

            console.log($("#organizerPhone").val())
        })

        $("#update").click(function (){
            let organizerUnit = $("#organizerUnit").val();
            let organizerEmail = $("#organizerEmail").val();
            let organizerPhone = $("#participantWorkUnit").val();
            let organizerPass = $("#organizerPass").val();
            $.ajax({
                type: "POST",
                dataType: "json",
                url: '/organizer/updateOrganizer',
                contentType: "application/json",
                data:JSON.stringify({
                    //"participantId":5,
                    "organizerUnit":organizerUnit,
                    "organizerEmail":organizerEmail,
                    "organizerPhone":organizerPhone,
                    "organizerPass": organizerPass,
                }),
                success: function (jsonData,result) {
                    console.log("data is :" + result);
                    if (jsonData["data"]["token"]) {

                        window.location.href = "组织者主页面.html";
                    } else {
                        console.log(jsonData["data"]["token"]);
                        alert("登录失败，请重试");
                    }
                }
            });
            // return false;
        })

    })


    function getOrganizerInfo($organizerId) {
        $.ajax({
            async: false,
            headers: {
                'token': token,
            },
            url: "/organizer/getOrganizerInfo",
            type: "get",
            dataType: "json",
            data: {
                'organizerId': $organzierId,
            },
            success: function (data) {
                console.log(data);
                if (data["code"] === 200) {
                    organizer = data["data"]["getOrganizerInfo"];
                    console.log(organizer);
                } else {
                    alert("获取用户数据失败");
                }
            },
            error: function () {
                alert("获取用户数据失败");
            },
        });
    }
    // function updateParticipantInfo(){
    //
    // }
    /*获取token里面的用户数据*/
    function parseJwt(token) {
        var base64Url = token.split('.')[1];
        var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
        var jsonPayload = decodeURIComponent(atob(base64).split('').map(function (c) {
            return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
        }).join(''));
        return JSON.parse(jsonPayload);
    }


</script>
</body>
</html>